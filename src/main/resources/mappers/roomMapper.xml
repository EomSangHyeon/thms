<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.thms.mapper.RoomMapper">

	<select id="insert" resultType="RoomVO">
		insert into tbl_room(rmnumber,
		rmheadcount)
		values(#{rmnumber},#{rmheadcount});
	</select>

	<select id="listAll" resultType="RoomVO"> 
	<![CDATA[ 
	SELECT `rmid`, `rmnumber`, `rmheadcount` 
		 FROM 
	 `tbl_room` 
		 WHERE `rmid`>0 ORDER BY `rmid` DESC 
		]]>
	</select>

	<select id="readPage" resultType="RoomVO">
		SELECT
		`rmid`, `rmnumber`,
		`rmheadcount`
		FROM
		`tbl_room`
		WHERE
		`rmid`=#{rmid}
	</select>

	<update id="update">
		update tbl_room set
		`rmid` =#{rmid},`rmnumber`
		=#{rmnumber},`rmheadcount` =#{rmheadcount}
		where
		`rmid`=#{rmid}
	</update>

	<delete id="delete">
		delete from tbl_room where `rmid`=#{rmid}
	</delete>


	<select id="listPage" resultType="RoomVO"> 
	<![CDATA[ 
	SELECT `rmid`, `rmnumber`, `rmheadcount` 
		 FROM 
	 `tbl_room` 
		 WHERE `rmid`>0 ORDER BY `rmid` DESC
		 limit #{pageStart},#{perPageNum} 
		]]>
	</select>

	<select id="listCriteria" resultType="RoomVO"> 
	<![CDATA[ 

		SELECT `rmid`, `rmnumber`, `rmheadcount` 
		 FROM 
		 	`tbl_room` 
		 WHERE 
		 	`rmid`>0 ORDER BY `rmid` DESC 
		 limit #{pageStart},#{perPageNum}  
		]]>
	</select>

	<select id="countPaging" resultType="int"> 
	<![CDATA[ 
		select count(rmid) 
			from
		tbl_room 
			where 
		rmid>0 
		]]>
	</select>

	<sql id="search">
		<if test="searchType != null">
			<if test="searchType == 'id'.toString()">
				where `rmid` LIKE CONCAT('%', #{keyword}, '%')
			</if>
			<if test="searchType == 'na'.toString()">
				where `rmnumber` LIKE CONCAT('%', #{keyword}, '%')
			</if>
		</if>
	</sql>
	<sql id="search1">
		<if test="searchType != null">
			<if test="searchType == 'id'.toString()">
				and `rmid` LIKE CONCAT('%', #{keyword}, '%')
			</if>
			<if test="searchType == 'na'.toString()">
				and `rmnumber` LIKE CONCAT('%', #{keyword}, '%')
			</if>
		</if>
	</sql>

	<!-- hong -->
	<select id="honglistSearch" resultType="RoomVO">
		SELECT `rmid`, `rmnumber`, `rmheadcount`,
		(SELECT COUNT(`rmid`) FROM
		`tbl_hospitalize` WHERE `rmid`=`tbl_room`.`rmid`)
		AS `rmcurrentcount`
		FROM `tbl_room`

		<where>

			<choose>
				<when test="searchType == 'rmid'">
					rmid like CONCAT('%',#{keyword},'%')
					ORDER BY `rmid`
					desc
					limit #{pageStart},#{perPageNum}
				</when>
				<when test="searchType == 'rmnumber'">
					rmnumber like CONCAT('%',#{keyword},'%')
					ORDER BY `rmid` desc
					limit #{pageStart},#{perPageNum}
				</when>
			</choose>

		</where>


	</select>
	<select id="listSearch" resultType="RoomVO">

	<![CDATA[ 
    	 SELECT     `rmid`, `rmnumber`,  `rmheadcount`,   
        (SELECT COUNT(`rmid`) FROM `tbl_hospitalize` WHERE `rmid`=`tbl_room`.`rmid`) AS `rmcurrentcount`  
        FROM   `tbl_room`
		]]>
		<include refid="search"></include>
		<![CDATA[
		ORDER BY `rmid` desc
		limit #{pageStart},#{perPageNum}
		]]>
		<!-- SELECT `rmid`, `rmnumber`, `rmheadcount`, (SELECT COUNT(`rmid`) FROM 
			`tbl_hospitalize` WHERE `rmid`=`tbl_room`.`rmid`) AS `rmcurrentcount` FROM 
			`tbl_room` where `rmnumber` LIKE '%E%' ORDER BY `rmid` desc -->



		<!-- SELECT `rmid`, `rmnumber`, `rmheadcount`, (SELECT COUNT(`rmid`) FROM 
			`tbl_hospitalize` WHERE `rmid`=`tbl_room`.`rmid`) AS `rmcurrentcount` FROM 
			`tbl_room` ORDER BY `rmid` DESC (select b.rmid, b.rmnumber , b.rmheadcount 
			- count(b.rmid) rmcurrentcount, b.rmheadcount from tbl_hospitalize a, tbl_room 
			b where a.rmid = b.rmid group by a.rmid desc ) -->
		<!-- SELECT `rmid`, `rmnumber`, `rmheadcount` FROM `tbl_room` WHERE `rmid`>0 -->
		<!-- ORDER BY `rmid` DESC limit #{pageStart},#{perPageNum} -->
	</select>

	<select id="listSearchCount" resultType="int"> 
	<![CDATA[ 
		select count(rmid) 
			from
		tbl_room 
			where 
		rmid>0 
		]]>
		<include refid="search1"></include>
	</select>

	<select id="getHospitalizeListByUID" resultType="PatientViewVO">
		<![CDATA[
			SELECT 
				* 
			FROM 
				`view_hospitalize` 
		]]>

		<if test="searchType != null">
			WHERE `uid`=#{keyword} 
		</if>

		<![CDATA[ 
			ORDER BY `horegdate` DESC 
			LIMIT #{pageStart}, #{perPageNum}
		]]>
	</select>
	<select id="listHospitalizeCount" resultType="Integer">
		<![CDATA[
			SELECT 
				COUNT(*) 
			FROM 
				`view_hospitalize` 
		]]>

		<if test="searchType != null">
			WHERE `uid`=#{keyword} 
		</if>
	</select>

</mapper> 
