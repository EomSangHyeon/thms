<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.thms.mapper.ReservationMapper">
	<insert id="add" parameterType="ReservationVO">
		INSERT INTO `tbl_reservation` (`sjid`, `did`, `ampm`, `rdate`, `uid`, `regdate`) 
		VALUES (#{sjid}, #{did}, #{ampm}, #{rdate}, #{uid}, NOW())
	</insert>

	<select id="getScheduleList" parameterType="ReservationDTO" resultType="ReservationVO">
		<![CDATA[
			SELECT 
				* 
			FROM 
				`tbl_reservation` 
			WHERE 
				`sjid`=#{sjid} AND `did`=#{did} AND LEFT(`rdate`, 7)=#{searchMonth}
		]]>
	</select>

	<select id="getScheduleListByUID" resultType="ReservationViewVO">
		<![CDATA[
			SELECT 
				* 
			FROM 
				`view_reservation` 
		]]>

		<if test="searchType != null">
			WHERE `uid`=#{keyword} 
		</if>

		<![CDATA[ 
			ORDER BY `rdate` DESC 
			LIMIT #{pageStart}, #{perPageNum}
		]]>
	</select>

	<select id="listSearchCount" resultType="int">
		<![CDATA[
			SELECT 
				COUNT(*) 
			FROM 
				`view_reservation` 
		]]>

		<if test="searchType != null">
			WHERE `uid`=#{keyword}
		</if>
	</select>

	<delete id="del" parameterType="int">
		DELETE FROM `tbl_reservation` WHERE `rid`=#{rid}
	</delete>

</mapper>